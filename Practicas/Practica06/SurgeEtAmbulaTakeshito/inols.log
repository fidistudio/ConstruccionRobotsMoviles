






Started logging.

<<<
Content-Length: 3770

{"id":1,"params":{"rootPath":"/home/fidel/ConstruccionRobotsMoviles/Practicas/Practica06/SurgeEtAmbulaTakeshito","clientInfo":{"name":"Neovim","version":"0.11.4+gcec0ecabd8"},"processId":12699,"workDoneToken":"1","initializationOptions":{},"rootUri":"file:///home/fidel/ConstruccionRobotsMoviles/Practicas/Practica06/SurgeEtAmbulaTakeshito","trace":"off","capabilities":{"window":{"showDocument":{"support":true},"workDoneProgress":true,"showMessage":{"messageActionItem":{"additionalPropertiesSupport":true}}},"general":{"positionEncodings":["utf-8","utf-16","utf-32"]},"textDocument":{"signatureHelp":{"dynamicRegistration":false,"signatureInformation":{"activeParameterSupport":true,"documentationFormat":["markdown","plaintext"],"parameterInformation":{"labelOffsetSupport":true}}},"formatting":{"dynamicRegistration":true},"completion":{"dynamicRegistration":false,"completionItemKind":{"valueSet":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]},"completionItem":{"resolveSupport":{"properties":["additionalTextEdits","command"]},"deprecatedSupport":true,"preselectSupport":false,"commitCharactersSupport":false,"snippetSupport":true,"documentationFormat":["markdown","plaintext"],"tagSupport":{"valueSet":[1]}},"completionList":{"itemDefaults":["editRange","insertTextFormat","insertTextMode","data"]},"contextSupport":true},"declaration":{"linkSupport":true},"documentSymbol":{"dynamicRegistration":false,"hierarchicalDocumentSymbolSupport":true,"symbolKind":{"valueSet":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]}},"inlayHint":{"dynamicRegistration":true,"resolveSupport":{"properties":["textEdits","tooltip","location","command"]}},"rename":{"dynamicRegistration":true,"prepareSupport":true},"semanticTokens":null,"diagnostic":{"dynamicRegistration":false,"tagSupport":{"valueSet":[1,2]}},"callHierarchy":{"dynamicRegistration":false},"publishDiagnostics":{"dataSupport":true,"relatedInformation":true,"tagSupport":{"valueSet":[1,2]}},"rangeFormatting":{"dynamicRegistration":true,"rangesSupport":true},"codeAction":{"dataSupport":true,"resolveSupport":{"properties":["edit","command"]},"isPreferredSupport":true,"codeActionLiteralSupport":{"codeActionKind":{"valueSet":["","quickfix","refactor","refactor.extract","refactor.inline","refactor.rewrite","source","source.organizeImports"]}},"dynamicRegistration":true},"foldingRange":{"dynamicRegistration":false,"foldingRange":{"collapsedText":true},"lineFoldingOnly":true,"foldingRangeKind":{"valueSet":["comment","imports","region"]}},"hover":{"dynamicRegistration":true,"contentFormat":["markdown","plaintext"]},"synchronization":{"dynamicRegistration":false,"willSave":true,"didSave":true,"willSaveWaitUntil":true},"references":{"dynamicRegistration":false},"implementation":{"linkSupport":true},"typeDefinition":{"linkSupport":true},"documentHighlight":{"dynamicRegistration":false},"codeLens":{"dynamicRegistration":false,"resolveSupport":{"properties":["command"]}},"definition":{"linkSupport":true,"dynamicRegistration":true}},"workspace":{"configuration":true,"workspaceEdit":{"resourceOperations":["rename","create","delete"]},"didChangeConfiguration":{"dynamicRegistration":false},"inlayHint":{"refreshSupport":true},"applyEdit":true,"workspaceFolders":true,"semanticTokens":null,"symbol":{"dynamicRegistration":false,"symbolKind":{"valueSet":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26]}},"didChangeWatchedFiles":{"dynamicRegistration":false,"relativePatternSupport":true}}},"workspaceFolders":[{"name":"/home/fidel/ConstruccionRobotsMoviles/Practicas/Practica06/SurgeEtAmbulaTakeshito","uri":"file:///home/fidel/ConstruccionRobotsMoviles/Practicas/Practica06/SurgeEtAmbulaTakeshito"}]},"jsonrpc":"2.0","method":"initialize"}
>>>
Content-Length: 940

{"jsonrpc":"2.0","id":1,"result":{"capabilities":{"textDocumentSync":{"openClose":true,"change":2,"save":{"includeText":true}},"completionProvider":{"triggerCharacters":[".","\u003c","\u003e",":","\"","/"],"allCommitCharacters":[" ","\t","(",")","[","]","{","}","\u003c","\u003e",":",";",",","+","-","/","*","%","^","\u0026","#","?",".","=","\"","'","|"],"completionItem":{}},"hoverProvider":{},"signatureHelpProvider":{"triggerCharacters":["(",","]},"definitionProvider":{},"documentHighlightProvider":{},"documentSymbolProvider":{},"codeActionProvider":{"codeActionKinds":["quickfix","refactor","info"]},"documentFormattingProvider":{},"documentRangeFormattingProvider":{},"documentOnTypeFormattingProvider":{"firstTriggerCharacter":"\n"},"renameProvider":{},"executeCommandProvider":{"commands":["clangd.applyFix","clangd.applyTweak"]},"workspaceSymbolProvider":{}},"serverInfo":{"name":"arduino-language-server","version":"0.0.0-git"}}}
<<<
Content-Length: 52

{"params":{},"jsonrpc":"2.0","method":"initialized"}Content-Length: 5618

{"params":{"textDocument":{"languageId":"arduino","version":0,"text":"#include <Arduino.h>\n#include \"MotorPWM.h\"\n#include \"IRSensor.h\"\n#include \"ContactSensor.h\"\n#include \"DifferentialDrive.h\"\n#include \"LightSensorArray.h\"\n\n// === Pines ===\nconstexpr int ENCODER_LEFT_PIN  = 2;\nconstexpr int ENCODER_RIGHT_PIN = 3;\n\nconstexpr int LEFT_SPEED_PIN  = 5;\nconstexpr int LEFT_DIR_PIN    = 4;\nconstexpr int RIGHT_SPEED_PIN = 6;\nconstexpr int RIGHT_DIR_PIN   = 7;\n\nconstexpr int IR_LEFT_PIN = A3;\nconstexpr int IR_RIGHT_PIN = A5;\nconstexpr int IR_FRONT_PIN = A4;\nconstexpr int IR_LEFT_THRESHOLD = 380;\nconstexpr int IR_RIGHT_THRESHOLD = 380;\nconstexpr int IR_FRONT_THRESHOLD = 380;\n\nconstexpr int LEFT_CONTACT_PIN = 9;\nconstexpr int RIGHT_CONTACT_PIN = 8;\n\nconstexpr int LIGHT_THRESHOLD = 75;\n\n// === Sensores IR ===\nIRSensor irLeft(IR_LEFT_PIN, IR_LEFT_THRESHOLD);\nIRSensor irRight(IR_RIGHT_PIN, IR_RIGHT_THRESHOLD);\nIRSensor irFront(IR_FRONT_PIN, IR_FRONT_THRESHOLD);\n\n// === Sensores Contacto ===\nContactSensor contactLeft(LEFT_CONTACT_PIN, false);\nContactSensor contactRight(RIGHT_CONTACT_PIN, false);\n\n// === Motores ===\nMotorPWM leftMotor(LEFT_SPEED_PIN, LEFT_DIR_PIN);\nMotorPWM rightMotor(RIGHT_SPEED_PIN, RIGHT_DIR_PIN);\n\n// === Sensor de luz ===\nLightSensorArray sensorArray(LIGHT_THRESHOLD);\n\n// === Drive ===\nDifferentialDrive::Params P{\n  .wheelRadiusLeft  = 0.04269f / 2.0f,\n  .wheelRadiusRight = 0.04415f / 2.0f,\n  .wheelBase        = 0.09790f,\n  .ticksPerRev      = 700,\n  .duty             = 150\n};\n\nDifferentialDrive drive(leftMotor, rightMotor,contactLeft, contactRight, P);\n\n// === ISR trampolines ===\nvoid onLeftEncoderTick()  { drive.onLeftTick(); }\nvoid onRightEncoderTick() { drive.onRightTick(); }\n\n// === Sensor handler ===\nfloat shs(char* /*sensor*/, int num) {\n  bool obs = false;\n  if (num == 1) {\n    irLeft.update();\n    contactLeft.update();\n    obs = irLeft.isObstacleDetected() || contactLeft.isObstacleDetected();\n  } else if (num ==2) {\n    irRight.update();\n    contactRight.update();\n    obs = irRight.isObstacleDetected() || contactRight.isObstacleDetected();\n  } else {\n    irFront.update();\n    obs = irFront.isObstacleDetected();\n  }\n  return obs ? 1.0f : 0.0f;\n}\n\n// === Macros de movimiento ===\nfloat AVANCE_RAW = random(25,40);\nfloat AVANCE = AVANCE_RAW * 0.001;  // Metros\nfloat GIRO   = random(40,50);     // Grados\n\n#define ADELANTE  drive.moveRobot( AVANCE,  0.0f)\n#define ATRAS     drive.moveRobot(-AVANCE,  0.0f)\n#define GIRO_IZQ  drive.moveRobot( 0.0f,   +GIRO)\n#define GIRO_DER  drive.moveRobot( 0.0f,   -GIRO)\n#define ALTO      drive.stop()\n\n// === Setup ===\nvoid setup() {\n  Serial.begin(9600);\n  drive.begin();\n  sensorArray.begin();\n\n  attachInterrupt(digitalPinToInterrupt(ENCODER_LEFT_PIN),  onLeftEncoderTick,  RISING);\n  attachInterrupt(digitalPinToInterrupt(ENCODER_RIGHT_PIN), onRightEncoderTick, RISING);\n\n  // drive.setDebug(true);\n  Serial.println(F(\"FSM + DifferentialDrive listos.\"));\n}\n\n// === Loop principal ===\nvoid loop() {\nsensorArray.readSectors();\n  static int estado = 0;\n  uint8_t brightest = sensorArray.getBrightestSector();\n\n  float Si = shs((char*)\"contact\", 1);\n  float Sd = shs((char*)\"contact\", 2);\n  float Sf = shs((char*)\"contact\", 3);\n\n  switch (estado) {\n    \n    case 0:\n      if (sensorArray.hasArrivedToDestination()) {\n        estado = 0; \n        ALTO; \n        Serial.println(\"ALTO\");\n      }\n      else {\n        estado = 1; \n        ADELANTE; \n        Serial.println(\"ADELANTE\"); \n      }\n    break; \n\n    case 1:\n      if      (Sf == 1)                  { estado = 6;  ALTO;      Serial.println(\"ALTO\"); }\n      else if (Si == 1 && Sd == 0)       { estado = 4;  ALTO;      Serial.println(\"ALTO\"); }\n      else if (Si == 0 && Sd == 1)       { estado = 2;  ALTO;      Serial.println(\"ALTO\"); }\n      else if (Si == 0 && Sd == 0)       { estado = 13; ADELANTE;  Serial.println(\"ADELANTE\"); }\n      break;\n\n\n    case 2:  estado = 3;  ATRAS;     Serial.println(\"ATRAS\");     break;\n    case 3:  estado = 0;  GIRO_IZQ;  Serial.println(\"IZQUIERDA\"); break;\n    case 4:  estado = 5;  ATRAS;     Serial.println(\"ATRAS\");     break;\n    case 5:  estado = 0;  GIRO_DER;  Serial.println(\"DERECHA\");   break;\n    case 6:  estado = 7;  ATRAS;     Serial.println(\"ATRAS\");     break;\n    case 7:  estado = 8;  GIRO_IZQ;  Serial.println(\"IZQUIERDA\"); break;\n    case 8:  estado = 9;  GIRO_IZQ;  Serial.println(\"IZQUIERDA\"); break;\n    case 9:  estado = 10; ADELANTE;  Serial.println(\"ADELANTE\");  break;\n    case 10: estado = 11; ADELANTE;  Serial.println(\"ADELANTE\");  break;\n    case 11: estado = 12; GIRO_DER;  Serial.println(\"DERECHA\");   break;\n    case 12: estado = 0;  GIRO_DER;  Serial.println(\"DERECHA\");   break;\n\n    case 13:\n      if (brightest == 3) {\n        estado = 3;\n        ADELANTE;\n        Serial.println(\"ADELANTE\");\n      } \n      else if (brightest == 2) {\n        estado = 5;\n        ADELANTE;\n        Serial.println(\"ADELANTE\");\n      } \n      else if (brightest == 1) {\n        estado = 3;\n        GIRO_IZQ;\n        Serial.println(\"GIRO IZQUIERDA\");\n      } \n      else if (brightest == 0) {\n        estado = 5;\n        GIRO_DER;\n        Serial.println(\"GIRO DERECHA\");\n      }\n      break;\n  }\n\n  delay(40);\n}\n","uri":"file:///home/fidel/ConstruccionRobotsMoviles/Practicas/Practica06/SurgeEtAmbulaTakeshito/SurgeEtAmbulaTakeshito.ino"}},"jsonrpc":"2.0","method":"textDocument/didOpen"}